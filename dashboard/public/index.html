<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Trade Intelligence Engine</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap"
        rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bg-base: #050b14;
            --surface: #0a1322;
            --surface-hover: #121f33;
            --neon-blue: #00d2ff;
            --neon-purple: #9d4edd;
            --neon-green: #00ff88;
            --neon-red: #ff3366;
            --glass-border: rgba(255, 255, 255, 0.05);
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-base);
            color: #e2e8f0;
            background-image:
                radial-gradient(ellipse at top right, rgba(157, 78, 221, 0.15), transparent 50%),
                radial-gradient(ellipse at bottom left, rgba(0, 210, 255, 0.1), transparent 50%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .mono {
            font-family: 'JetBrains Mono', monospace;
        }

        /* Glassmorphism Classes */
        .glass-panel {
            background: rgba(10, 19, 34, 0.6);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        .glass-card {
            background: rgba(18, 31, 51, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glass-card:hover {
            transform: translateY(-5px);
            background: rgba(18, 31, 51, 0.7);
            border-color: rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px -10px rgba(0, 210, 255, 0.2);
        }

        /* Gradients */
        .text-gradient {
            background: linear-gradient(to right, var(--neon-blue), var(--neon-purple));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Animations */
        @keyframes pulse-slow {

            0%,
            100% {
                opacity: 0.5;
            }

            50% {
                opacity: 1;
            }
        }

        .animate-pulse-slow {
            animation: pulse-slow 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes scanline {
            0% {
                transform: translateY(-100%);
            }

            100% {
                transform: translateY(100%);
            }
        }

        .model-status-indicator {
            position: relative;
            overflow: hidden;
        }

        .model-status-indicator::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, transparent, rgba(0, 210, 255, 0.2), transparent);
            animation: scanline 2s linear infinite;
            pointer-events: none;
        }

        /* Value Colors - Dynamic Injection via JS */
        .val-buy {
            color: var(--neon-green);
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        .val-sell {
            color: var(--neon-red);
            text-shadow: 0 0 10px rgba(0, 255, 102, 0.5);
        }

        .val-hold {
            color: #f59e0b;
            text-shadow: 0 0 10px rgba(245, 158, 11, 0.5);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-base);
        }

        ::-webkit-scrollbar-thumb {
            background: #1f2937;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #374151;
        }

        .action-btn {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: all 0.5s ease;
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            z-index: -1;
            opacity: 0.4;
        }
    </style>
</head>

<body class="relative">
    <!-- Ambient Background Orbs -->
    <div class="orb w-96 h-96 bg-blue-600 top-0 left-0 -translate-x-1/2 -translate-y-1/2"></div>
    <div class="orb w-96 h-96 bg-purple-600 bottom-0 right-0 translate-x-1/2 translate-y-1/2"></div>

    <!-- Header -->
    <nav class="glass-panel sticky top-0 z-50 px-6 py-4 mb-8">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div
                    class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center shadow-lg shadow-blue-500/30">
                    <i class="fas fa-brain text-white text-xl"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold tracking-wide">Neural<span class="text-gradient">Trade</span></h1>
                    <div class="flex items-center gap-2 text-xs text-gray-400">
                        <span class="relative flex h-2 w-2">
                            <span
                                class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                            <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
                        </span>
                        Ensemble Mode Active (RF + Deep Learning)
                    </div>
                </div>
            </div>

            <div class="flex items-center gap-4">
                <a href="monitoring.html"
                    class="glass-card px-4 py-2 text-sm font-semibold hover:bg-white/10 flex items-center gap-2 text-blue-400">
                    <i class="fas fa-chart-line"></i> Monitoring
                </a>
                <button id="toggleStream"
                    class="glass-card px-4 py-2 text-sm font-semibold hover:bg-white/10 flex items-center gap-2 text-green-400">
                    <i class="fas fa-pause"></i> Pause Stream
                </button>
                <div class="h-8 w-px bg-white/10"></div>
                <div
                    class="text-sm border border-white/10 px-3 py-1.5 rounded-full flex items-center gap-2 bg-black/20">
                    <i class="fas fa-clock text-blue-400"></i>
                    <span id="clock" class="mono text-gray-300">00:00:00</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Dashboard -->
    <main class="max-w-7xl mx-auto px-6 pb-20">

        <!-- Live Suggestion Banner -->
        <div class="mb-8">
            <h2 class="text-sm uppercase tracking-widest text-gray-500 font-semibold mb-4">Latest Deep Learning
                Suggestion</h2>

            <div id="heroSuggestion" class="glass-panel p-8 rounded-2xl relative overflow-hidden group">
                <div class="absolute top-0 left-0 w-1 h-full bg-gray-500 transition-colors duration-500"
                    id="heroAccentLine"></div>

                <div class="flex flex-col md:flex-row gap-8 items-center justify-between">

                    <!-- Market Context -->
                    <div class="flex-1 w-full relative z-10">
                        <div class="flex items-center gap-3 mb-6">
                            <span
                                class="px-3 py-1 rounded-full bg-blue-500/10 text-blue-400 border border-blue-500/20 text-xs font-bold tracking-wider"
                                id="heroModelType">
                                WAITING FOR STREAM...
                            </span>
                            <span class="text-xs text-gray-400 mono">MARKET SYNC: T-0.1s</span>
                        </div>

                        <div class="grid grid-cols-2 gap-4 mb-2">
                            <div>
                                <p class="text-gray-500 text-xs uppercase">Target Price</p>
                                <p class="font-bold text-2xl mono" id="heroPrice">$0.00</p>
                            </div>
                            <div>
                                <p class="text-gray-500 text-xs uppercase">24h Volatility</p>
                                <p class="font-bold text-2xl mono" id="heroVol">0.00%</p>
                            </div>
                            <div>
                                <p class="text-gray-500 text-xs uppercase">RSI Momentum</p>
                                <p class="font-bold text-xl mb-1 mono" id="heroRsi">0.00</p>
                                <div class="w-full h-1.5 bg-gray-800 rounded-full overflow-hidden">
                                    <div class="h-full bg-gradient-to-r from-blue-500 to-purple-500 w-0 transition-all duration-500"
                                        id="heroRsiBar"></div>
                                </div>
                            </div>
                            <div>
                                <p class="text-gray-500 text-xs uppercase">Market Sentiment</p>
                                <p class="font-bold text-xl mono" id="heroSentiment">Neutral</p>
                            </div>
                        </div>
                    </div>

                    <!-- Neural Decision -->
                    <div
                        class="flex-1 w-full bg-black/40 rounded-xl p-6 border border-white/5 relative z-10 model-status-indicator">
                        <div class="text-center mb-6">
                            <p class="text-xs text-gray-500 uppercase tracking-widest mb-2">Ensemble AI Decision</p>
                            <h2 class="text-6xl font-black tracking-tight" id="heroDecision">---</h2>
                            <p class="mt-2 text-sm text-gray-400">Confidence Score: <span
                                    class="font-bold mono text-white" id="heroConfidence">0%</span></p>
                        </div>

                        <div class="flex gap-4">
                            <button id="btnExecute"
                                class="action-btn flex-1 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-400 hover:to-emerald-500 text-white font-bold py-4 rounded-xl shadow-lg shadow-green-500/20 transform hover:-translate-y-1 opacity-50 cursor-not-allowed">
                                <i class="fas fa-bolt mr-2"></i> EXECUTE
                            </button>
                            <button id="btnSkip"
                                class="flex-1 bg-gray-800 hover:bg-gray-700 border border-gray-600 text-white font-bold py-4 rounded-xl transition-all hover:border-gray-400 opacity-50 cursor-not-allowed">
                                <i class="fas fa-forward mr-2"></i> SKIP
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Telemetry & Raw Data -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Feature Importance from Random Forest -->
            <div class="glass-card p-6 lg:col-span-1 flex flex-col">
                <h3 class="text-white font-semibold mb-4 flex items-center gap-2">
                    <i class="fas fa-network-wired text-purple-400"></i> Neural Pathway Weights
                </h3>
                <div class="flex-1 bg-black/30 rounded-lg p-4 font-mono text-xs text-gray-400 space-y-3 overflow-hidden"
                    id="modelReasons">
                    <p class="animate-pulse">Awaiting matrix sync...</p>
                </div>
            </div>

            <!-- Raw Market Data Feed -->
            <div class="glass-card p-6 lg:col-span-2">
                <h3 class="text-white font-semibold mb-4 flex items-center gap-2">
                    <i class="fas fa-terminal text-blue-400"></i> Raw Feature Matrix
                </h3>
                <div class="bg-[#0b101e] border border-white/5 rounded-lg p-4 h-48 overflow-y-auto">
                    <pre class="mono text-xs text-green-400" id="rawFeatureLog">> System Initializing...
> Loading Random Forest & MLP Ensemble Models...
> Waiting for incoming market vectors...</pre>
                </div>
            </div>
        </div>
    </main>

    <!-- Modals -->
    <div id="executionModal"
        class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden items-center justify-center z-50 opacity-0 transition-opacity duration-300">
        <div
            class="bg-gray-900 border border-green-500/30 p-8 rounded-2xl max-w-sm w-full mx-4 shadow-2xl shadow-green-500/20 transform scale-95 transition-transform duration-300">
            <div
                class="w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-6 text-green-400 text-2xl">
                <i class="fas fa-check"></i>
            </div>
            <h3 class="text-2xl font-bold text-center mb-2">Trade Executed</h3>
            <p class="text-gray-400 text-center text-sm mb-6">The AI suggestion was accepted and sent to the trading
                logic layer.</p>
            <button class="w-full bg-gray-800 hover:bg-gray-700 py-3 rounded-xl font-semibold transition-colors"
                onclick="closeModal()">Continue Monitoring</button>
        </div>
    </div>

    <script>
        // UI Logic
        function updateClock() {
            document.getElementById('clock').textContent = new Date().toLocaleTimeString();
        }
        setInterval(updateClock, 1000);
        updateClock();

        let streamPaused = false;
        let eventSource = null;
        let lastActionedLog = "";

        const DOM = {
            accentLine: document.getElementById('heroAccentLine'),
            decision: document.getElementById('heroDecision'),
            confidence: document.getElementById('heroConfidence'),
            modelType: document.getElementById('heroModelType'),
            price: document.getElementById('heroPrice'),
            vol: document.getElementById('heroVol'),
            rsi: document.getElementById('heroRsi'),
            rsiBar: document.getElementById('heroRsiBar'),
            sentiment: document.getElementById('heroSentiment'),
            reasons: document.getElementById('modelReasons'),
            log: document.getElementById('rawFeatureLog'),
            btnExecute: document.getElementById('btnExecute'),
            btnSkip: document.getElementById('btnSkip'),
            toggleBtn: document.getElementById('toggleStream')
        };

        // Actions
        DOM.btnExecute.addEventListener('click', () => {
            if (DOM.btnExecute.classList.contains('opacity-50')) return;
            showModal();
            addLog(`> [USER ACTION] ⚡ EXECUTED suggestion: ${lastActionedLog}`, "text-green-300");
            disableButtons();
        });

        DOM.btnSkip.addEventListener('click', () => {
            if (DOM.btnSkip.classList.contains('opacity-50')) return;
            addLog(`> [USER ACTION] ⏭ SKIPPED suggestion: ${lastActionedLog}`, "text-gray-500");
            disableButtons();
        });

        DOM.toggleBtn.addEventListener('click', () => {
            streamPaused = !streamPaused;
            DOM.toggleBtn.innerHTML = streamPaused
                ? '<i class="fas fa-play"></i> Resume Stream'
                : '<i class="fas fa-pause"></i> Pause Stream';

            DOM.toggleBtn.className = `glass-card px-4 py-2 text-sm font-semibold hover:bg-white/10 flex items-center gap-2 ${streamPaused ? 'text-yellow-400' : 'text-green-400'}`;
            addLog(streamPaused ? '> [SYSTEM] Stream paused by user.' : '> [SYSTEM] Stream resumed.');
        });

        function enableButtons(decision) {
            if (decision === 'HOLD') {
                disableButtons();
                return;
            }
            DOM.btnExecute.classList.remove('opacity-50', 'cursor-not-allowed');
            DOM.btnSkip.classList.remove('opacity-50', 'cursor-not-allowed');
        }

        function disableButtons() {
            DOM.btnExecute.classList.add('opacity-50', 'cursor-not-allowed');
            DOM.btnSkip.classList.add('opacity-50', 'cursor-not-allowed');
        }

        function addLog(msg, colorClass = "text-blue-200") {
            const time = new Date().toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit', fractionalSecondDigits: 3 });
            DOM.log.innerHTML += `\n<span class="${colorClass}">[${time}] ${msg}</span>`;
            DOM.log.parentElement.scrollTop = DOM.log.parentElement.scrollHeight;
        }

        function showModal() {
            const modal = document.getElementById('executionModal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modal.firstElementChild.classList.remove('scale-95');
                modal.firstElementChild.classList.add('scale-100');
            }, 10);
        }

        function closeModal() {
            const modal = document.getElementById('executionModal');
            modal.classList.add('opacity-0');
            modal.firstElementChild.classList.remove('scale-100');
            modal.firstElementChild.classList.add('scale-95');
            setTimeout(() => {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }, 300);
        }

        // Setup SSE Connection
        function connectSSE() {
            addLog('> [NETWORK] Initiating connection to AI Inference port 3000...', 'text-yellow-400');

            eventSource = new EventSource('/api/ml/stream');

            eventSource.onopen = () => {
                addLog('> [NETWORK] Connection established. Receiving matrices.', 'text-green-400');
            };

            eventSource.onmessage = (e) => {
                if (streamPaused) return;

                const data = JSON.parse(e.data);
                const p = data.prediction;
                const f = data.features;

                // Update UI based on decision
                DOM.decision.textContent = p.decision;
                DOM.decision.className = `text-6xl font-black tracking-tight val-${p.decision.toLowerCase()}`;

                DOM.confidence.textContent = `${p.confidence}%`;
                DOM.modelType.textContent = `${p.model_type} [v2.0]`;

                // Accent Line Color
                if (p.decision === 'BUY') DOM.accentLine.className = "absolute top-0 left-0 w-1 h-full shadow-[0_0_15px_#00ff88] bg-green-400 transition-colors duration-500";
                else if (p.decision === 'SELL') DOM.accentLine.className = "absolute top-0 left-0 w-1 h-full shadow-[0_0_15px_#ff3366] bg-red-500 transition-colors duration-500";
                else DOM.accentLine.className = "absolute top-0 left-0 w-1 h-full bg-yellow-500 transition-colors duration-500";

                // Features
                DOM.price.textContent = `$${f.price.toFixed(2)}`;
                DOM.vol.textContent = `${f.volatility.toFixed(2)}%`;
                DOM.rsi.textContent = f.rsi.toFixed(1);
                DOM.rsiBar.style.width = `${f.rsi}%`;

                let sentText = 'Neutral';
                if (f.sentiment > 0.5) sentText = 'Bullish';
                if (f.sentiment < -0.5) sentText = 'Bearish';
                DOM.sentiment.textContent = sentText;

                // Reasons
                DOM.reasons.innerHTML = p.reasons.map((r, i) =>
                    `<div class="flex items-center gap-2"><span class="text-blue-500">[#${i + 1}]</span> ${r}</div>`
                ).join('');

                // Log
                lastActionedLog = `${p.decision} @ $${f.price.toFixed(2)} (Conf: ${p.confidence}%)`;
                addLog(`> [AI INFERENCE] Computed: ${lastActionedLog}`);

                // Enable/Disable Action logic
                enableButtons(p.decision);
            };

            eventSource.onerror = () => {
                addLog('> [NETWORK] Connection lost. Reconnecting...', 'text-red-400');
            };
        }

        // Initialize
        connectSSE();

    </script>
</body>

</html>